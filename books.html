<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Books</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.1/axios.min.js"></script>
	</head>
	<body>
		<form>
			<label for="bookname"> Book name </label>
			<input type="text" name="bookname" id="bookname" />
			<input type="button" onclick="generatelist(this.form)" value="Submit" />

			<label for="author"> Book author (if any) </label>
			<input type="text" name="author" id="author" />
		</form>

		<div id="output">Results here</div>

		<script>
			const key = 'AIzaSyC5bcbf2cdVxf0OwUPdWBegVueFlRPR9Sg';
			function checkSale(b) {
				let sale;
				if ((b.saleInfo.saleability = 'FOR_SALE')) {
					let price = b.saleInfo.listPrice ? b.saleInfo.listPrice.amount : null;
					if (price) sale = `Available for ${price} Rs.`;
					else sale = 'Available';
				} else sale = 'Not Available';
				return sale;
			}
			function checkEbook(book) {
				let output;
				if ((book.epub.isAvailable = true)) {
					book.epub.acsTokenLink
						? (output = `Available at ${book.epub.acsTokenLink}`)
						: (output = 'Available');
				} else output = 'Not available';
				return output;
			}
			function checkPdf(book) {
				let output;
				if ((book.pdf.isAvailable = true)) {
					book.pdf.acsTokenLink
						? (output = `Available at ${book.pdf.acsTokenLink}`)
						: (output = 'Available');
				} else output = 'Not available';
				return output;
			}

			let url;
			function generatelist(form) {
				let index = [];
				const bname = form.bookname.value;
				const author = form.author.value;
				if (author) {
					url = `https://www.googleapis.com/books/v1/volumes?q=${bname}+inauthor:${author}&key=${key}`;
				} else
					url = `https://www.googleapis.com/books/v1/volumes?q=${bname}&key=${key}`;

				axios(url)
					.then((response) => {
						response.data.items.forEach((book) => {
							const r = book.volumeInfo;
							const a = {
								Title: r.title || 'No Name Given',
								Subtitle: r.subtitle
									? r.subtitle.toString()
									: 'No Subtitle provided for this book',
								Authors: r.authors
									? r.authors.toString()
									: 'No Authors Provided',
								Publisher: r.publisher ? r.publisher : null,
								Pages: r.pageCount ? r.pageCount.toString() : null,
								Categories: r.categories ? r.categories.toString() : null,
								Sale: checkSale(book),
								BuyLink: book.saleInfo.buylink
									? book.saleInfo.buylink
									: 'No link Provided',
								hasEbook: checkEbook(book.accessInfo),
								hasPDF: checkPdf(book.accessInfo),
							};
							// const newDiv = document.createElement('div');
							// const data = document.createTextNode(JSON.stringify(a));
							// newDiv.appendChild(data);
							index.push(JSON.stringify(a));
						});
						const oldDiv = document.getElementById('output');
						let newDiv = document.createElement('div');
						const data = document.createTextNode(index);
						newDiv.appendChild(data);
						oldDiv.replaceChildren(newDiv);
						// index.forEach((t) => {
						// 	const data = document.createTextNode(JSON.stringify(t));
						// 	newDiv.appendChild(data);
						// 	document.body.insertBefore(newDiv, oldDiv);
						// });
					})
					.catch((err) => console.log(err));
			}
		</script>
	</body>
</html>
